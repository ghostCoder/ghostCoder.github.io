"use strict";(self.webpackChunkTeams_PR_Manager=self.webpackChunkTeams_PR_Manager||[]).push([[302],{1302:(e,n,t)=>{t.r(n),t.d(n,{PRTable:()=>V});var s=t(2791),r=t(535),i=t(8127),l=t(5194),a=t(2963),o=t(7447),d=t(2138),c=t(7643),p=t(484),m=t(5306),u=t(9132),h=t(4810),x=t(9664),g=t(6012),j=t(6475),v=t(4299),S=t(5953),w=t(2966),b=t(184);const P=(0,r.Z)({skeleton:{width:"90px"}}),y=e=>{let{type:n}=e;const t=P();return(0,b.jsx)(g.K,{children:(0,b.jsx)(S.O,{className:t.skeleton,appearance:"opaque",children:(0,b.jsx)(w.j,{})})})};var C=t(974),R=t(9658),f=t(4914),k=t(1719),I=t(4525),A=t(497),H=t(672),K=t(8174),z=t(2475),L=t(4711);var M,O=t(5792),q=t(7974),U=t(8646),T=t(168),W=t(9383);const $=(0,W.Ps)(M||(M=(0,T.Z)(["\n  mutation SetMergeRequestReviewers(\n    $projectPath: ID!\n    $iid: String!\n    $reviewerUsernames: [String!]!\n  ) {\n    mergeRequestSetReviewers(\n      input: {\n        projectPath: $projectPath\n        iid: $iid\n        reviewerUsernames: $reviewerUsernames\n        operationMode: REPLACE\n      }\n    ) {\n      errors\n      mergeRequest {\n        reviewers {\n          nodes {\n            username\n            name\n          }\n        }\n      }\n    }\n  }\n"])));var E;const G=(0,W.Ps)(E||(E=(0,T.Z)(["\n  mutation SetMergeRequestAssignees(\n    $projectPath: ID!\n    $iid: String!\n    $assigneeUsernames: [String!]!\n  ) {\n    mergeRequestSetAssignees(\n      input: {\n        projectPath: $projectPath\n        iid: $iid\n        assigneeUsernames: $assigneeUsernames\n        operationMode: REPLACE\n      }\n    ) {\n      errors\n      mergeRequest {\n        assignees {\n          nodes {\n            username\n            name\n          }\n        }\n      }\n    }\n  }\n"])));var B=t(6147);const _=e=>{let{item:n,people:t,selectedPeople:r,setSelectedPeople:i,focusOnMount:l,notify:a,comboBoxRef:o,type:d,projectPath:c,iid:p,setEditMode:m}=e;const[u,h]=(0,s.useState)(r?r.map((e=>e.text)).join(", "):""),{reload:x,members:g}=(0,s.useContext)(q.Kz),{setGitInCache:j}=(0,s.useContext)(q.zm);(0,s.useEffect)((()=>{var e;l&&(null===(e=o.current)||void 0===e||e.focus())}),[o,l]);const v=((e,n)=>[...new Map([...e.map((e=>({key:e.username,text:e.name}))),...n.map((e=>({key:e.username,text:e.name})))].map((e=>[e.key,e]))).values()])(g,t);return(0,b.jsx)(z.h,{appearance:"underline",ref:o,multiselect:!0,placeholder:d===B.H8.setAssignees?"Select assignees":"Select reviewers",defaultOpen:!!r.length,selectedOptions:r.map((e=>JSON.stringify(e))),size:"small",value:u,onOptionSelect:async(e,t)=>{try{const e=await(0,O.a)();console.log("GitLab PAT validated: ",e)}catch(l){console.log("GitLab PAT validation failed: ",l),String(l).startsWith("TypeError: Failed to fetch")?(a("error","offline or network does not have access to GitLab"),x()):j(!1)}const s=t.selectedOptions.map((e=>JSON.parse(e)));console.log("newPeople",s);const r=s.map((e=>e.key));if(d===B.H8.setReviewers)try{const e=(await U.i.mutate({mutation:$,variables:{projectPath:c,iid:p,reviewerUsernames:r}})).data.mergeRequestSetReviewers.mergeRequest.reviewers.nodes;console.log("Updated reviewers to: ",e),console.log(n),n.reviewers=e,i((()=>e.map((e=>({key:e.username,text:e.name}))))),h(e?null===e||void 0===e?void 0:e.map((e=>e.name)).join(", "):""),a("success","Reviewers updated!")}catch(l){console.log("Error while mutation: ",l),a("error","Action unauthorized or scopes missing from token (required: 'api').")}else try{const e=(await U.i.mutate({mutation:G,variables:{projectPath:c,iid:p,assigneeUsernames:r}})).data.mergeRequestSetAssignees.mergeRequest.assignees.nodes;console.log("Updated assignees to: ",e),n.assignees=e,i(e.map((e=>({key:e.username,text:e.name})))),h(e?null===e||void 0===e?void 0:e.map((e=>e.name)).join(", "):""),console.log("Setting assignees to : ",e.map((e=>({key:e.username,text:e.name})))),a("success","Reviewers updated!")}catch(l){console.log("Error while mutation: ",l),a("error","Action unauthorized or scopes missing from token (required: 'api').")}},onOpenChange:()=>{r.length>0&&m(!1)},style:{minWidth:"unset"},input:{style:{width:190}},children:v.map((e=>(0,b.jsx)(L.W,{text:JSON.stringify(e),children:e.text},e.key)))})},N=e=>{let{item:n,people:t,projectPath:r,iid:i,type:l}=e;const a=(0,C.Me)("toaster"),{dispatchToast:o}=(0,R.P)(a),d=(e,n)=>o((0,b.jsxs)(f.F,{children:[(0,b.jsx)(k.M,{action:(0,b.jsx)(I.P,{children:(0,b.jsx)(A.r,{appearance:"subtle",children:(0,b.jsx)(x.x,{weight:"bold",children:"x"})})}),children:e}),(0,b.jsx)(H.Y,{children:n})]}),{intent:e}),[c,p]=(0,s.useState)(!t.length),[m,h]=(0,s.useState)((()=>t.map((e=>({key:e.username,text:e.name}))))),g=(0,s.useRef)(null),v=(0,s.useCallback)((()=>{p(!0)}),[]);return!1===c?(0,b.jsxs)(u.K,{enableScopedSelectors:!0,tokens:{childrenGap:"0.5em"},onClick:v,children:[(0,b.jsx)(K.x,{toasterId:a}),m.map((e=>(0,b.jsx)(j.I,{name:e.text,size:"small",textAlignment:"center",avatar:{color:"colorful"}})))]}):(0,b.jsxs)(u.K,{children:[(0,b.jsx)(K.x,{toasterId:a}),(0,b.jsx)(_,{item:n,people:t,selectedPeople:m,setSelectedPeople:h,notify:d,comboBoxRef:g,type:l,projectPath:r,iid:i,setEditMode:p,focusOnMount:0!==m.length})]})};var Z=t(9037);const F=e=>{let{title:n,webUrl:t}=e;const s=(0,Z.Z)(n),r=-1===(i=n).indexOf("]",0)?i:i.slice(i.indexOf("]",0)+1);var i;return(0,b.jsxs)(x.x,{children:[0!==s.length?"[ ":"",s.map(((e,n)=>(0,b.jsxs)(x.x,{children:[(0,b.jsx)(A.r,{href:B.D7+e,target:"_blank",children:e}),n!==s.length-1?" | ":""]},e))),0!==s.length?" ] ":"",(0,b.jsx)(A.r,{href:t,target:"_blank",children:r})]})},J=[(0,h.p)({columnId:"title",renderHeaderCell:()=>(0,b.jsx)(x.x,{weight:"bold",align:"center",children:"Title"}),renderCell:e=>(0,b.jsx)(g.K,{truncate:!0,children:(0,b.jsx)(F,{title:e.title,webUrl:e.webUrl})})}),(0,h.p)({columnId:"assignees",renderHeaderCell:()=>(0,b.jsx)(x.x,{weight:"bold",align:"center",children:"Assignees"}),renderCell:e=>void 0===e.assignees?(0,b.jsx)(y,{type:"person"}):(0,b.jsx)(g.K,{truncate:!0,children:(0,b.jsx)(N,{item:e,people:e.assignees,projectPath:e.projectPath,iid:e.iid,type:B.H8.setAssignees})})}),(0,h.p)({columnId:"reviewers",renderHeaderCell:()=>(0,b.jsx)(x.x,{weight:"bold",align:"center",children:"Reviewers"}),renderCell:e=>(0,b.jsx)(g.K,{truncate:!0,children:(0,b.jsx)(N,{item:e,people:e.reviewers,projectPath:e.projectPath,iid:e.iid,type:B.H8.setReviewers})})}),(0,h.p)({columnId:"approvedBy",renderHeaderCell:()=>(0,b.jsx)(x.x,{weight:"bold",align:"center",children:"Approved By"}),renderCell:e=>(0,b.jsx)(g.K,{truncate:!0,children:(0,b.jsx)(u.K,{enableScopedSelectors:!0,tokens:{childrenGap:"0.3em"},children:e.approvedBy.map((e=>(0,b.jsx)(j.I,{name:e.name,size:"small",avatar:{color:"colorful"},textAlignment:"center"})))})})}),(0,h.p)({columnId:"prStatus",renderHeaderCell:()=>(0,b.jsx)(x.x,{weight:"bold",align:"center",children:"PR Status"}),renderCell:e=>(0,b.jsx)(g.K,{truncate:!0,media:e.prStatus&&(0,b.jsx)(e.prStatus.Icon,{primaryFill:e.prStatus.iconColor}),children:(0,b.jsx)(x.x,{children:e.prStatus.status})})}),(0,h.p)({columnId:"pipelineStatus",renderHeaderCell:()=>(0,b.jsx)(x.x,{weight:"bold",align:"center",children:"Pipeline Status"}),renderCell:e=>{var n;return(0,b.jsx)(g.K,{truncate:!0,media:null!==(n=e.pipelineStatus)&&void 0!==n&&n.Icon?(0,b.jsx)(e.pipelineStatus.Icon,{primaryFill:e.pipelineStatus.iconColor}):null,children:(0,b.jsx)(x.x,{children:e.pipelineStatus.status})})}}),(0,h.p)({columnId:"jiraLabels",renderHeaderCell:()=>(0,b.jsx)(x.x,{weight:"bold",align:"center",children:"Jira Labels"}),renderCell:e=>void 0===e.jiraLabels?(0,b.jsx)(y,{type:"label"}):(0,b.jsx)(g.K,{children:(0,b.jsx)(u.K,{horizontal:!0,wrap:!0,enableScopedSelectors:!0,tokens:{childrenGap:"0.4em"},children:e.jiraLabels.map((e=>(0,b.jsx)(v.C,{appearance:"tint",size:"medium",children:e},e)))})})}),(0,h.p)({columnId:"prLabels",renderHeaderCell:()=>(0,b.jsx)(x.x,{weight:"bold",align:"center",children:"PR Labels"}),renderCell:e=>(0,b.jsx)(g.K,{children:(0,b.jsx)(u.K,{horizontal:!0,wrap:!0,enableScopedSelectors:!0,tokens:{childrenGap:"0.4em"},children:e.prLabels.map((e=>(0,b.jsx)(v.C,{appearance:"tint",size:"medium",children:e.title},e.title)))})})})],D=J.slice(0,4).concat(J.slice(5)),Y={title:{minWidth:340},assignees:{minWidth:220},reviewers:{minWidth:220},approvedBy:{minWidth:115},prStatus:{minWidth:140},pipelineStatus:{minWidth:150},jiraLabels:{minWidth:425},prLabels:{minWidth:425}},Q=(0,r.Z)({row:{paddingTop:"1em",paddingBottom:"1em"},tableHeader:{textAlign:"center",verticalAlign:"middle"}}),V=e=>{let{items:n,tabType:t}=e;const[r,u]=(0,s.useState)(Y),h=(0,s.useCallback)(((e,n)=>{let{columnId:t,width:s}=n;u((e=>({...e,[t]:{...e[t],idealWidth:s}})))}),[]),x=t===B.gn.groupsMergedPRs?D:J,{columnSizing_unstable:g,tableRef:j}=(0,i.S)({columns:x,items:n},[(0,l.v)({columnSizingOptions:r,onColumnResize:h})]),v=Q();return(0,b.jsxs)(a.i,{ref:j,children:[(0,b.jsx)(o.x,{children:(0,b.jsx)(d.S,{children:x.map(((e,n)=>(0,b.jsx)(c.x,{...g.getTableHeaderCellProps(e.columnId),children:e.renderHeaderCell()},e.columnId)))})}),(0,b.jsx)(p.R,{children:n.map((e=>(0,b.jsx)(d.S,{children:x.map((n=>(0,b.jsx)(m.p,{className:v.row,...g.getTableCellProps(n.columnId),children:n.renderCell(e)},n.columnId)))},e.key)))})]})}}}]);
//# sourceMappingURL=302.77c0871d.chunk.js.map